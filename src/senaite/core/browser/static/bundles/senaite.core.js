(()=>{"use strict";var e={311:e=>{e.exports=jQuery}},t={};function n(i){var a=t[i];if(void 0!==a)return a.exports;var r=t[i]={exports:{}};return e[i](r,r.exports,n),r.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e=n(311),t=n.n(e);const i=function(){var e=this;e.baseUrl=t()("body").attr("data-i18ncatalogurl"),e.currentLanguage=t()("html").attr("lang")||"en",e.currentLanguage.split("-").length>1&&(e.currentLanguage=e.currentLanguage.split("-")[0]+"_"+e.currentLanguage.split("-")[1].toUpperCase()),e.storage=null,e.catalogs={},e.ttl=864e5,Date.now||(Date.now=function(){return(new Date).valueOf()});try{"localStorage"in window&&null!==window.localStorage&&"JSON"in window&&null!==window.JSON&&(e.storage=window.localStorage)}catch(e){}e.configure=function(t){for(var n in t)e[n]=t[n]},e._setCatalog=function(t,n,i){t in e.catalogs||(e.catalogs[t]={}),e.catalogs[t][n]=i},e._storeCatalog=function(t,n,i){var a=t+"-"+n;null!==e.storage&&null!==i&&(e.storage.setItem(a,JSON.stringify(i)),e.storage.setItem(a+"-updated",Date.now()))},e.getUrl=function(t,n){return e.baseUrl+"?domain="+t+"&language="+n},e.loadCatalog=function(n,i){if(void 0===i&&(i=e.currentLanguage),null!==e.storage){var a=n+"-"+i;if(a in e.storage&&Date.now()-parseInt(e.storage.getItem(a+"-updated"),10)<e.ttl){var r=JSON.parse(e.storage.getItem(a));return void e._setCatalog(n,i,r)}}e.baseUrl&&t().getJSON(e.getUrl(n,i),(function(t){null!==t&&(e._setCatalog(n,i,t),e._storeCatalog(n,i,t))}))},e.MessageFactory=function(t,n){return n=n||e.currentLanguage,function(i,a){var r,o,l;if(r=t in e.catalogs&&n in e.catalogs[t]&&i in e.catalogs[t][n]?e.catalogs[t][n][i]:i,a)for(l in a)a.hasOwnProperty(l)&&(o=new RegExp("\\$\\{"+l+"\\}","g"),r=r.replace(o,a[l]));return r}}};var a=null,r=function(e,t){if(null===a){var n=new i;n.loadCatalog("senaite.core"),a=n.MessageFactory("senaite.core")}return a(e,t)},o=null,l=function(e,t){if(null===o){var n=new i;n.loadCatalog("plone"),o=n.MessageFactory("plone")}return o(e,t)},s=["name","error"],u=["message","level"],c=["title","message"],d=["name"],f=["name"],v=["name","message"],m=["name","message"],h=["name","value"],y=["selector","html"],g=["selector","name","value"],_=["selector","event","name"];function p(e){return p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},p(e)}function b(e,t){if(null==e)return{};var n,i,a=function(e,t){if(null==e)return{};var n,i,a={},r=Object.keys(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function w(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=k(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){l=!0,r=e},f:function(){try{o||null==n.return||n.return()}finally{if(l)throw r}}}}function k(e,t){if(e){if("string"==typeof e)return S(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?S(e,t):void 0}}function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function T(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,(void 0,a=function(e,t){if("object"!==p(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,"string");if("object"!==p(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(i.key),"symbol"===p(a)?a:String(a)),i)}var a}const x=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.config=Object.assign({form_selectors:[],field_selectors:[]},t),this.hooked_fields=[],this.on_mutated=this.on_mutated.bind(this),this.on_modified=this.on_modified.bind(this),this.on_submit=this.on_submit.bind(this),this.on_blur=this.on_blur.bind(this),this.on_click=this.on_click.bind(this),this.on_change=this.on_change.bind(this),this.on_reference_select=this.on_reference_select.bind(this),this.on_reference_deselect=this.on_reference_deselect.bind(this),this.init_forms()}var n,i;return n=e,i=[{key:"init_forms",value:function(){var e,t=w(this.config.form_selectors);try{for(t.s();!(e=t.n()).done;){var n=e.value,i=document.querySelector(n);i&&"FORM"===i.tagName&&(this.setup_form(i),this.watch_form(i))}}catch(e){t.e(e)}finally{t.f()}}},{key:"setup_form",value:function(e){this.ajax_send(e,{},"initialized")}},{key:"watch_form",value:function(e){var t,n=w(this.get_form_fields(e));try{for(n.s();!(t=n.n()).done;){var i=t.value;this.hook_field(i)}}catch(e){n.e(e)}finally{n.f()}this.observe_mutations(e),e.addEventListener("modified",this.on_modified),e.addEventListener("mutated",this.on_mutated),e.hasAttribute("ajax-submit")&&e.addEventListener("submit",this.on_submit)}},{key:"hook_field",value:function(e){-1===this.hooked_fields.indexOf(e)&&(this.is_button(e)||this.is_input_button(e)?e.addEventListener("click",this.on_click):this.is_reference(e)?(e.addEventListener("select",this.on_reference_select),e.addEventListener("deselect",this.on_reference_deselect)):this.is_text(e)||this.is_textarea(e)?e.addEventListener("change",this.on_change):this.is_select(e)?(e.addEventListener("click",this.on_click),e.addEventListener("change",this.on_change)):this.is_radio(e)||this.is_checkbox(e)?e.addEventListener("click",this.on_click):e.addEventListener("blur",this.on_blur),this.hooked_fields=this.hooked_fields.concat(e))}},{key:"observe_mutations",value:function(e){new MutationObserver((function(t){var n=new CustomEvent("mutated",{detail:{form:e,mutations:t}});e.dispatchEvent(n)})).observe(e,{childList:!0,subtree:!0})}},{key:"handle_mutation",value:function(e,t){var n=t.target,i=(n.closest(".field"),t.addedNodes),a=(t.removedNodes,this.config.field_selectors);if(this.is_multiple_select(n))return this.notify(e,n,"modified");if(i&&n.ELEMENT_NODE){var r,o=w(n.querySelectorAll(a));try{for(o.s();!(r=o.n()).done;){var l=r.value;this.hook_field(l)}}catch(e){o.e(e)}finally{o.f()}}return i.length>0?this.notify_added(e,i,"added"):void 0}},{key:"toggle_submit",value:function(e,t){e.querySelector("input[type='submit']").disabled=!t}},{key:"toggle_field_visibility",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=e.closest(".field"),i="d-none";!1===t?n.classList.add(i):n.classList.remove(i)}},{key:"has_field_errors",value:function(e){return e.querySelectorAll(".is-invalid").length>0}},{key:"set_field_readonly",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;e.setAttribute("readonly",""),e.setAttribute("disabled","");var n=e.parentElement.querySelector("div.message");if(n)n.innerHTML=_t(t);else{var i=document.createElement("div");i.className="message text-secondary small",i.innerHTML=_t(t),e.parentElement.appendChild(i)}}},{key:"set_field_editable",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;e.removeAttribute("readonly"),e.removeAttribute("disabled");var n=e.parentElement.querySelector("div.message");if(n)n.innerHTML=_t(t);else{var i=document.createElement("div");i.className="message text-secondary small",i.innerHTML=_t(t),e.parentElement.appendChild(i)}}},{key:"set_field_error",value:function(e,t){e.classList.add("is-invalid");var n=e.parentElement.querySelector("div.invalid-feedback");if(n)n.innerHTML=_t(t);else{var i=document.createElement("div");i.className="invalid-feedback",i.innerHTML=_t(t),e.parentElement.appendChild(i)}}},{key:"remove_field_error",value:function(e){e.classList.remove("is-invalid");var t=e.parentElement.querySelector(".invalid-feedback");t&&t.remove()}},{key:"add_statusmessage",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",n=arguments.length>2?arguments[2]:void 0;n=n||{};var i=document.createElement("div"),a=n.title||"".concat(t.charAt(0).toUpperCase()+t.slice(1));i.innerHTML='\n      <div class="alert alert-'.concat(t,' alert-dismissible fade show" role="alert">\n        <strong>').concat(a,"</strong>\n        ").concat(_t(e),'\n        <button type="button" class="close" data-dismiss="alert" aria-label="Close">\n          <span aria-hidden="true">&times;</span>\n        </button>\n      </div>\n    '),i=i.firstElementChild;var r=document.getElementById("viewlet-above-content");if(n.flush){var o,l=w(r.querySelectorAll(".alert"));try{for(l.s();!(o=l.n()).done;)o.value.remove()}catch(e){l.e(e)}finally{l.f()}}return r.appendChild(i),i}},{key:"add_notification",value:function(e,t,n){n=n||{},n=Object.assign({animation:!0,autohide:!0,delay:5e3},n);var i=document.createElement("div");i.innerHTML='\n      <div class="toast" style="width:300px" role="alert"\n           data-animation="'.concat(n.animation,'"\n           data-autohide="').concat(n.autohide,'"\n           data-delay="').concat(n.delay,'">\n        <div class="toast-header">\n          <strong class="mr-auto">').concat(e.charAt(0).toUpperCase()+e.slice(1),'</strong>\n          <button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="Close">\n            <span aria-hidden="true">&times;</span>\n          </button>\n        </div>\n        <div class="toast-body">\n          ').concat(_t(t),"\n        </div>\n      </div>\n    "),i=i.firstElementChild;var a=document.querySelector(".toast-container");return a||((a=document.createElement("div")).innerHTML='\n        <div style="position: fixed; top: 0px; right: 0px; width=100%;">\n          <div class="toast-container" style="position: absolute; top: 10px; right: 10px;">\n          </div>\n        </div>\n      ',document.querySelector(".container-fluid").appendChild(a),a=a.querySelector(".toast-container")),a.appendChild(i),i}},{key:"update_form",value:function(e,n){var i,a=this,r=n.hide||[],o=n.show||[],l=n.readonly||[],p=n.editable||[],k=n.errors||[],S=n.messages||[],T=n.notifications||[],x=n.updates||[],E=n.html||[],L=n.attributes||[],j=n.callbacks||[],O=w(k);try{for(O.s();!(i=O.n()).done;){var C,A,P=i.value;C=P.name,A=P.error,b(P,s);var q=this.get_form_field_by_name(e,C);q&&(A?this.set_field_error(q,A):this.remove_field_error(q))}}catch(e){O.e(e)}finally{O.f()}var I,M=w(S);try{for(M.s();!(I=M.n()).done;){var N,D=I.value;z=D.message,U=D.level,N=b(D,u);var U=U||"info",z=z||"";this.add_statusmessage(z,U,N)}}catch(e){M.e(e)}finally{M.f()}var H,R=w(T);try{for(R.s();!(H=R.n()).done;){var F,G,J,W=H.value;F=W.title,G=W.message,J=b(W,c);var B=this.add_notification(F,G,J);t()(B).toast("show")}}catch(e){R.e(e)}finally{R.f()}var K,V=w(r);try{for(V.s();!(K=V.n()).done;){var $,X=K.value;$=X.name,b(X,d);var Q=this.get_form_field_by_name(e,$);Q&&this.toggle_field_visibility(Q,!1)}}catch(e){V.e(e)}finally{V.f()}var Y,Z=w(o);try{for(Z.s();!(Y=Z.n()).done;){var ee,te=Y.value;ee=te.name,b(te,f);var ne=this.get_form_field_by_name(e,ee);ne&&this.toggle_field_visibility(ne,!0)}}catch(e){Z.e(e)}finally{Z.f()}var ie,ae=w(l);try{for(ae.s();!(ie=ae.n()).done;){var re,oe,le=ie.value;re=le.name,oe=le.message,b(le,v);var se=this.get_form_field_by_name(e,re);se&&this.set_field_readonly(se,oe)}}catch(e){ae.e(e)}finally{ae.f()}var ue,ce=w(p);try{for(ce.s();!(ue=ce.n()).done;){var de,fe,ve=ue.value;de=ve.name,fe=ve.message,b(ve,m);var me=this.get_form_field_by_name(e,de);me&&this.set_field_editable(me,fe)}}catch(e){ce.e(e)}finally{ce.f()}var he,ye=w(x);try{for(ye.s();!(he=ye.n()).done;){var ge,_e,pe=he.value;ge=pe.name,_e=pe.value,b(pe,h);var be=this.get_form_field_by_name(e,ge);be&&this.set_field_value(be,_e)}}catch(e){ye.e(e)}finally{ye.f()}var we,ke=w(E);try{for(ke.s();!(we=ke.n()).done;){var Se,Te,xe,Ee=we.value;Se=Ee.selector,Te=Ee.html,xe=b(Ee,y);var Le=e.querySelector(Se);Le&&(xe.append?Le.innerHTML=Le.innerHTML+Te:Le.innerHTML=Te)}}catch(e){ke.e(e)}finally{ke.f()}var je,Oe=w(L);try{for(Oe.s();!(je=Oe.n()).done;){var Ce,Ae,Pe,qe=je.value;Ce=qe.selector,Ae=qe.name,Pe=qe.value,b(qe,g);var Ie=e.querySelector(Ce);Ie&&(null===Pe?Ie.removeAttribute(Ae):Ie.addAttribute(Ae,Pe))}}catch(e){Oe.e(e)}finally{Oe.f()}var Me,Ne=w(j);try{var De=function(){var t,n,i,r=Me.value;t=r.selector,n=r.event,i=r.name,b(r,_);var o=function(t){var n={name:i,target:t.currentTarget};a.ajax_send(e,n,"callback")};"document"===t?document.addEventListener(n,o):document.querySelectorAll(t).forEach((function(e){e.addEventListener(n,o)}))};for(Ne.s();!(Me=Ne.n()).done;)De()}catch(e){Ne.e(e)}finally{Ne.f()}this.has_field_errors(e)?this.toggle_submit(e,!1):this.toggle_submit(e,!0)}},{key:"get_form_field_by_name",value:function(e,t){var n=e.querySelector("[name='".concat(t,"']")),i=e.querySelector("[name^='".concat(t,"']")),a=n||i||null;return null===a?null:a}},{key:"get_form_data",value:function(e){var t={};new FormData(e).forEach((function(e,n){t[n]=e}));var n=this.get_view_name();return n.indexOf("++add++")>-1&&(t.form_adapter_name=n),t}},{key:"get_form_fields",value:function(e){var t,n,i=[],a=w(this.config.field_selectors);try{for(a.s();!(t=a.n()).done;){var r,o=t.value,l=e.querySelectorAll(o);i=(r=i).concat.apply(r,function(e){if(Array.isArray(e))return S(e)}(n=l.values())||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(n)||k(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())}}catch(e){a.e(e)}finally{a.f()}return i}},{key:"get_field_name",value:function(e){return e.name.split(":")[0]}},{key:"get_field_value",value:function(e){if(this.is_checkbox(e))return e.checked;if(this.is_select(e)){var t=e.selectedOptions;return Array.prototype.map.call(t,(function(e){return e.value}))}return this.is_reference(e)?e.value.split("\n"):e.value}},{key:"set_field_value",value:function(e,t){var n=t.selected||[],i=t.options||[];if(this.is_reference(e))e.value=n.join("\n");else if(this.is_select(e)){if(0==n.length){var a=e.options[e.selected];a&&(n=[a.value])}e.options.length=0,i.sort((function(e,t){var n=e.title.toLowerCase(),i=t.title.toLowerCase();return null===e.value&&(n=""),null===t.value&&(i=""),n<i?-1:n>i?1:void 0}));var r,o=w(i);try{for(o.s();!(r=o.n()).done;){var l=r.value,s=document.createElement("option");s.value=l.value,s.innerHTML=l.title,-1!==n.indexOf(l.value)&&(s.selected=!0),e.appendChild(s)}}catch(e){o.e(e)}finally{o.f()}0==n.length&&(e.selectedIndex=0)}else this.is_checkbox(e)?e.checked=t:e.value=t}},{key:"modified",value:function(e){var t=new CustomEvent("modified",{detail:{field:e,form:e.form}});e.form.dispatchEvent(t)}},{key:"loading",value:function(){var e=new CustomEvent(arguments.length>0&&void 0!==arguments[0]&&!arguments[0]?"ajaxStop":"ajaxStart");document.dispatchEvent(e)}},{key:"notify",value:function(e,t,n){var i={name:this.get_field_name(t),value:this.get_field_value(t)};this.ajax_send(e,i,n)}},{key:"notify_added",value:function(e,t,n){var i={added:[]};t.forEach((function(e){var t={};if(e.attributes&&e.attributes.length>0){var n,a=w(e.attributes);try{for(a.s();!(n=a.n()).done;){var r=n.value,o=r.name,l=r.value;t[o]=l}}catch(e){a.e(e)}finally{a.f()}}Object.keys(t).length>0&&i.added.push(t)})),this.ajax_send(e,i,n)}},{key:"ajax_send",value:function(e,t,n){var i=document.body.dataset.viewUrl,a="".concat(i,"/ajax_form/").concat(n),r=Object.assign({form:this.get_form_data(e)},t),o={method:"POST",credentials:"include",body:JSON.stringify(r),headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector("#protect-script").dataset.token}};return this.ajax_request(e,a,o)}},{key:"ajax_submit",value:function(e,t,n){for(var i=document.body.dataset.viewUrl,a="".concat(i,"/ajax_form/").concat(n),r=new FormData(e),o=0,l=Object.entries(t);o<l.length;o++){var s=(d=l[o],f=2,function(e){if(Array.isArray(e))return e}(d)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,a,r,o,l=[],s=!0,u=!1;try{if(r=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;s=!1}else for(;!(s=(i=r.call(n)).done)&&(l.push(i.value),l.length!==t);s=!0);}catch(e){u=!0,a=e}finally{try{if(!s&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw a}}return l}}(d,f)||k(d,f)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),u=s[0],c=s[1];r.set(u,c)}var d,f,v={method:"POST",body:r};return this.ajax_request(e,a,v)}},{key:"ajax_request",value:function(e,t,n){var i=this;this.loading(!0);var a=new Request(t,n);return fetch(a).then((function(e){return e.ok?e.json():Promise.reject(e)})).then((function(t){i.update_form(e,t),i.loading(!1)})).catch((function(e){i.loading(!1)}))}},{key:"get_view_name",value:function(){return location.pathname.split("/").pop()}},{key:"toggle_disable",value:function(e,t){e&&(e.disabled=t)}},{key:"is_textarea",value:function(e){return"TEXTAREA"==e.tagName}},{key:"is_select",value:function(e){return"SELECT"==e.tagName}},{key:"is_multiple_select",value:function(e){return this.is_select(e)&&e.hasAttribute("multiple")}},{key:"is_input",value:function(e){return"INPUT"===e.tagName}},{key:"is_text",value:function(e){return this.is_input(e)&&"text"===e.type}},{key:"is_button",value:function(e){return"BUTTON"===e.tagName}},{key:"is_input_button",value:function(e){return this.is_input(e)&&"button"===e.type}},{key:"is_checkbox",value:function(e){return this.is_input(e)&&"checkbox"===e.type}},{key:"is_radio",value:function(e){return this.is_input(e)&&"radio"===e.type}},{key:"is_reference",value:function(e){return!!this.is_textarea(e)&&e.classList.contains("queryselectwidget-value")}},{key:"is_table_row",value:function(e){return"TR"===e.tagName}},{key:"on_mutated",value:function(e){var t,n=e.detail.form,i=[],a=w(e.detail.mutations);try{for(a.s();!(t=a.n()).done;){var r=t.value;i.indexOf(r.target)>-1||(i=i.concat(r.target),this.handle_mutation(n,r))}}catch(e){a.e(e)}finally{a.f()}}},{key:"on_modified",value:function(e){var t=e.detail.form,n=e.detail.field;this.notify(t,n,"modified")}},{key:"on_submit",value:function(e){var t=this;e.preventDefault();var n={},i=e.currentTarget.closest("form"),a=e.submitter;a&&(n[a.name]=a.value,this.toggle_disable(a,!0)),this.ajax_submit(i,n,"submit").then((function(e){return t.toggle_disable(a,!1)}))}},{key:"on_blur",value:function(e){var t=e.currentTarget;this.modified(t)}},{key:"on_click",value:function(e){var t=e.currentTarget;this.modified(t)}},{key:"on_change",value:function(e){var t=e.currentTarget;this.modified(t)}},{key:"on_reference_select",value:function(e){var t=e.currentTarget,n=t.value.split("\n");n=n.concat(e.detail.value),t.value=n.join("\n"),this.modified(t)}},{key:"on_reference_deselect",value:function(e){var t=e.currentTarget,n=t.value.split("\n"),i=n.indexOf(e.detail.value);i>-1&&n.splice(i,1),t.value=n.join("\n"),this.modified(t)}}],i&&T(n.prototype,i),Object.defineProperty(n,"prototype",{writable:!1}),e}();var E=n(311),L=function(e,t){return function(){return e.apply(t,arguments)}};const j=function(){function e(){this.set_cookie=L(this.set_cookie,this),this.read_cookie=L(this.read_cookie,this),this.authenticator=L(this.authenticator,this)}return e.prototype.authenticator=function(){var e;return(e=E("input[name='_authenticator']").val())||(e=new URLSearchParams(window.location.search).get("_authenticator")),e},e.prototype.read_cookie=function(e){var t,n,i;for(e+="=",n=document.cookie.split(";"),i=0;i<n.length;){for(t=n[i];" "===t.charAt(0);)t=t.substring(1);if(0===t.indexOf(e))return t.substring(e.length,t.length);i++}return null},e.prototype.set_cookie=function(e,t){var n,i;(n=new Date).setTime(n.getTime()+864e5),i="expires="+n.toUTCString(),document.cookie=e+"="+t+";"+i+";path=/"},e.prototype.add_notification=function(e,t,n){var i,a;return null==n&&(n={}),n=Object.assign({animation:!0,autohide:!0,delay:5e3},n),(i=document.createElement("div")).innerHTML="<div class='toast bg-white' style='width:300px' role='alert' data-animation='"+n.animation+"' data-autohide='"+n.autohide+"' data-delay='"+n.delay+"'> <div class='toast-header'> <strong class='mr-auto'>"+e+"</strong> <button type='button' class='ml-2 mb-1 close' data-dismiss='toast' aria-label='Close'> <span aria-hidden='true'>&times;</span> </button> </div> <div class='toast-body'> "+_t(t)+" </div> </div>",i=i.firstElementChild,(a=document.querySelector(".toast-container"))||((a=document.createElement("div")).innerHTML="<div style='position: fixed; top: 0px; right: 0px; width=100%; z-index:100'> <div class='toast-container' style='position: absolute; top: 10px; right: 10px;'> </div> </div>",document.querySelector(".container-fluid").appendChild(a),a=a.querySelector(".toast-container")),a.appendChild(i),E(i).toast("show")},e}();function O(e){return O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},O(e)}function C(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,(void 0,a=function(e,t){if("object"!==O(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,"string");if("object"!==O(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(i.key),"symbol"===O(a)?a:String(a)),i)}var a}const A=function(){function e(t){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.config=Object.assign({el:"sidebar",toggle_el:"sidebar-header",cookie_key:"sidebar-toggle",timeout:1e3},t),this.tid=null,this.maximize=this.maximize.bind(this),this.minimize=this.minimize.bind(this),this.on_click=this.on_click.bind(this),this.on_mouseenter=this.on_mouseenter.bind(this),this.on_mouseleave=this.on_mouseleave.bind(this),this.toggle_el=document.getElementById(this.config.toggle_el),this.toggle_el&&this.toggle_el.addEventListener("click",this.on_click),this.el=document.getElementById(this.config.el),this.el&&(this.el.addEventListener("mouseenter",this.on_mouseenter),this.el.addEventListener("mouseleave",this.on_mouseleave),this.is_toggled()&&(this.el.classList.remove("minimized"),this.el.classList.add("toggled"))),this}var t,n;return t=e,n=[{key:"is_toggled",value:function(){return"true"==window.site.read_cookie(this.config.cookie_key)}},{key:"toggle",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];window.site.set_cookie(this.config.cookie_key,e),e?(this.el.classList.add("toggled"),this.maximize()):(this.el.classList.remove("toggled"),this.minimize())}},{key:"minimize",value:function(){this.el.classList.add("minimized")}},{key:"maximize",value:function(){this.el.classList.remove("minimized")}},{key:"on_click",value:function(e){clearTimeout(this.tid),this.toggle(!this.is_toggled())}},{key:"on_mouseenter",value:function(e){clearTimeout(this.tid),this.is_toggled()||(this.tid=setTimeout(this.maximize,this.config.timeout))}},{key:"on_mouseleave",value:function(e){clearTimeout(this.tid),this.is_toggled()||this.minimize()}}],n&&C(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function P(e){return P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},P(e)}function q(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,(void 0,a=function(e,t){if("object"!==P(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,"string");if("object"!==P(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(i.key),"symbol"===P(a)?a:String(a)),i)}var a}const I=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.DataGrid=null,this.testParamTable=null,this.rawTestValue=null,this.rawTestInput=document.getElementById("form-widgets-raw_test_keywords"),this.rawTestInput&&this.load()}var n,i;return n=e,(i=[{key:"load",value:function(){this.rawTestValue=this.rawTestInput.value,this.makeReadonlyTestKeywords(),this.hideAAField(),this.wrapRawTestInput(this)}},{key:"getDataGridWidget",value:function(){return this.DataGrid||(this.DataGrid=window.widgets.datagrid),this.DataGrid}},{key:"getTestParamTable",value:function(){return this.testParamTable||(this.testParamTable=t()("tbody[data-name_prefix='form.widgets.test_parameters']")[0]),this.testParamTable}},{key:"makeReadonlyTestKeywords",value:function(){t()("input[id^='form-widgets-test_parameters-']").filter("[id$='-widgets-keyword']").each((function(e,n){return t()(n).attr("readonly",!0)})),t()("#form-widgets-test_result").attr("readonly",!0)}},{key:"hideAAField",value:function(){t()("tbody[data-name_prefix='form.widgets.test_parameters'] > tr").each((function(e,n){["AA","TT"].includes(t()(n).attr("data-index"))?t()(n).hide():t()(n).show()}))}},{key:"wrapRawTestInput",value:function(e){Object.defineProperty(this.rawTestInput,"value",{set:function(n){e.rawTestValue=n;var i=n.split(",").filter((function(e){return e})),a=e.getTestParamTable(),r=e.getDataGridWidget().get_visible_rows(a);if(0===i.length)for(var o=0;o<r.length-1;o++)e.getDataGridWidget().remove_row(r[o]);else if(i.length>r.length-1)for(var l=i.length-r.length+1,s=0;s<l;s++)e.getDataGridWidget().auto_append_row(a);else if(i.length<r.length-1)for(var u=0;u<r.length-1;u++){var c=t()(r[u]).find("input[id$='-widgets-keyword']");c&&(i.includes(null==c?void 0:c.val())||e.getDataGridWidget().remove_row(r[u]))}e.hideAAField(),e.getDataGridWidget().trigger_custom_event("update_test_parameters",i),e.makeReadonlyTestKeywords()},get:function(){return e.rawTestValue}})}}])&&q(n.prototype,i),Object.defineProperty(n,"prototype",{writable:!1}),e}();document.addEventListener("DOMContentLoaded",(function(){window.i18n=new i,window._t=r,window._p=l,window.portal_url=document.body.dataset.portalUrl,window.site=new j,window.sidebar=new A({el:"sidebar"}),new x({form_selectors:["form[name='edit_form']","form.senaite-ajax-form"],field_selectors:["input[type='text']","input[type='number']","input[type='checkbox']","input[type='radio']","input[type='file']","select","textarea"]}),document.body.addEventListener("datagrid:loaded",(function(e){new I})),t()((function(){t()("[data-toggle='tooltip']").tooltip(),t()("select.selectpicker").selectpicker()})),document.body.addEventListener("listing:after_transition_event",(function(e){for(var t=document.body.classList,n=0,i=["template-multi_results","template-multi_results_classic"];n<i.length;n++){var a=i[n];if(t.contains(a))return}document.body.dataset.reviewState!=e.detail.config.view_context_state&&location.reload()}))}))})()})();
//# sourceMappingURL=senaite.core.js.map